var v=Object.defineProperty;var C=(a,e,t)=>e in a?v(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var n=(a,e,t)=>(C(a,typeof e!="symbol"?e+"":e,t),t);class k{constructor(){n(this,"audio");n(this,"isCurrentlyPlaying",!1);n(this,"currentSource",null);n(this,"abortController",null);this.audio=new Audio,this.setupEventListeners()}setupEventListeners(){this.audio.addEventListener("ended",()=>{this.isCurrentlyPlaying=!1}),this.audio.addEventListener("error",e=>{console.error("Audio playback error:",e),this.isCurrentlyPlaying=!1}),this.audio.addEventListener("pause",()=>{this.isCurrentlyPlaying=!1}),this.audio.addEventListener("play",()=>{this.isCurrentlyPlaying=!0})}async play(e){try{if(this.stop(),this.currentSource=e,this.abortController=new AbortController,e.base64)this.audio.src=`data:audio/${e.format};base64,${e.base64}`;else if(e.url)this.audio.src=e.url;else throw new Error("No audio source provided");if(this.abortController.signal.aborted)return;this.audio.load(),await this.audio.play()}catch(t){throw console.error("Failed to play audio:",t),this.isCurrentlyPlaying=!1,t instanceof Error&&t.name==="NotAllowedError"?new Error("AUTOPLAY_BLOCKED"):t}}pause(){this.audio&&!this.audio.paused&&this.audio.pause()}stop(){this.abortController&&(this.abortController.abort(),this.abortController=null),this.audio&&(this.audio.pause(),this.audio.currentTime=0,this.audio.src="",this.isCurrentlyPlaying=!1)}isPlaying(){return this.isCurrentlyPlaying&&!this.audio.paused}getCurrentSource(){return this.currentSource}replay(){this.audio&&this.currentSource&&(this.audio.currentTime=0,this.isCurrentlyPlaying||this.play(this.currentSource))}}const M=new k,h="johnnycloud_chat_v2",w=50;class A{constructor(){n(this,"state");n(this,"saveTimeout",null);this.state=this.loadFromStorage()}loadFromStorage(){try{if(typeof localStorage>"u")return console.warn("localStorage not available, using default state"),this.getDefaultState();const e=localStorage.getItem(h);if(e){const t=JSON.parse(e);if(t.version==="v2")return{messages:(t.messages||[]).map(r=>({...r,timestamp:new Date(r.timestamp)})),threadId:t.threadId||"default",speakEnabled:t.speakEnabled||!1,selectedVoice:t.selectedVoice||"Joanna"}}}catch(e){console.warn("Failed to load chat state from storage:",e)}return this.getDefaultState()}getDefaultState(){return{messages:[{id:"1",text:"Hello! I'm Johnny-5, your AWS assistant. I can analyze costs, security posture, and compliance Guardrails (CIS/NIST/PCI). Ask me for a remediation plan, a savings estimate, or a Why AWS summary.",sender:"bot",timestamp:new Date}],threadId:"default",speakEnabled:!1,selectedVoice:"Joanna"}}saveToStorage(){this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=window.setTimeout(()=>{try{if(typeof localStorage>"u"){console.warn("localStorage not available, skipping save");return}const e={version:"v2",messages:this.state.messages.slice(-w),threadId:this.state.threadId,speakEnabled:this.state.speakEnabled,selectedVoice:this.state.selectedVoice};localStorage.setItem(h,JSON.stringify(e))}catch(e){console.warn("Failed to save chat state to storage:",e)}},300)}getState(){return{...this.state}}setMessages(e){this.state.messages=e,this.saveToStorage()}addMessage(e){this.state.messages.push(e),this.saveToStorage()}setThreadId(e){this.state.threadId=e,this.saveToStorage()}setSpeakEnabled(e){this.state.speakEnabled=e,this.saveToStorage()}setSelectedVoice(e){this.state.selectedVoice=e,this.saveToStorage()}clear(){this.state={messages:[{id:"1",text:"Hello! I'm Johnny-5, your AWS assistant. I can analyze costs, security posture, and compliance Guardrails (CIS/NIST/PCI). Ask me for a remediation plan, a savings estimate, or a Why AWS summary.",sender:"bot",timestamp:new Date}],threadId:"default",speakEnabled:!1,selectedVoice:"Joanna"},this.saveToStorage()}}const T=new A;function P(a){return a==null||Number.isNaN(a)?"—":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)}function D(a,e,t,r,o){if(e===0)return`${t} costs: new resource detected`;const s=(a-e)/e*100,l=s>0?`+${s.toFixed(0)}%`:`${s.toFixed(0)}%`;let i=`${t} costs ${l} vs baseline`;return r&&(i+=`, largely from ${r}`),o&&(i+=` in ${o}`),i}function L(a){switch(a.toLowerCase()){case"high":return"text-red-400 bg-red-500/20";case"medium":return"text-amber-400 bg-amber-500/20";case"low":return"text-green-400 bg-green-500/20";default:return"text-slate-400 bg-slate-500/20"}}function R(a){return a>=7?"High":a>=4?"Medium":"Low"}function _(a){const e=a.toLowerCase();return e.includes("high")||e.includes("critical")?"High":e.includes("medium")||e.includes("moderate")?"Medium":"Low"}function g(a,e,t){const r=[t.map(i=>i.label).join(","),...a.map(i=>t.map(u=>{const c=i[u.key];return typeof c=="string"&&(c.includes(",")||c.includes('"'))?`"${c.replace(/"/g,'""')}"`:c??""}).join(","))].join(`
`),o=new Blob([r],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),l=URL.createObjectURL(o);s.setAttribute("href",l),s.setAttribute("download",e),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}function x(a){const e=[{key:"timestamp",label:"Timestamp"},{key:"period",label:"Period"},{key:"service",label:"Service"},{key:"resource",label:"Resource"},{key:"region",label:"Region"},{key:"baseline_amount",label:"Baseline Amount"},{key:"current_amount",label:"Current Amount"},{key:"impact_percent",label:"Impact %"},{key:"driver_resource",label:"Driver Resource"},{key:"notes",label:"Notes"}],t=`johnnycloud_anomalies_${new Date().toISOString().slice(0,19).replace(/:/g,"")}.csv`;g(a,t,e)}function F(a){const e=[{key:"timestamp_first_seen",label:"First Seen"},{key:"timestamp_last_seen",label:"Last Seen"},{key:"provider",label:"Provider"},{key:"severity",label:"Severity"},{key:"title",label:"Title"},{key:"account",label:"Account"},{key:"region",label:"Region"},{key:"resource_id",label:"Resource ID"},{key:"status",label:"Status"},{key:"link",label:"Link"}],t=`johnnycloud_findings_${new Date().toISOString().slice(0,19).replace(/:/g,"")}.csv`;g(a,t,e)}const m="whyaws_planner_v1";class E{constructor(){n(this,"state");this.state=this.loadFromStorage()}loadFromStorage(){try{const e=localStorage.getItem(m);if(e){const t=JSON.parse(e);return{input:{workloads:6,dbType:"postgres",criticality:"medium",traffic:"steady",goal:"replatform",multiRegion:!1,regulated:!1,...t.input},assumptions:{downtimeCostPerHour:5e3,hoursAvoidedPerMonth:3,highSeverityExposures:12,latencyImprovement:25,...t.assumptions},savings:{rightsizingAdoption:75,idleSchedulingHours:8,includeStorageTransitions:!0,ec2MonthlyCost:2e3,s3MonthlyCost:500,...t.savings}}}}catch(e){console.error("Failed to load planner state from storage:",e)}return{input:{workloads:6,dbType:"postgres",criticality:"medium",traffic:"steady",goal:"replatform",multiRegion:!1,regulated:!1},assumptions:{downtimeCostPerHour:5e3,hoursAvoidedPerMonth:3,highSeverityExposures:12,latencyImprovement:25},savings:{rightsizingAdoption:75,idleSchedulingHours:8,includeStorageTransitions:!0,ec2MonthlyCost:2e3,s3MonthlyCost:500}}}saveToStorage(){try{localStorage.setItem(m,JSON.stringify(this.state))}catch(e){console.error("Failed to save planner state to storage:",e)}}getInput(){return this.state.input}setInput(e){this.state.input={...this.state.input,...e},this.saveToStorage()}getAssumptions(){return this.state.assumptions}setAssumptions(e){this.state.assumptions={...this.state.assumptions,...e},this.saveToStorage()}getSavings(){return this.state.savings}setSavings(e){this.state.savings={...this.state.savings,...e},this.saveToStorage()}buildPlan(e){const t=[];e.goal==="lift"&&t.push("rehost"),e.goal==="replatform"&&t.push("replatform"),e.goal==="refactor"&&t.push("refactor"),(e.dbType==="mixed"||e.criticality==="high")&&!t.includes("replatform")&&t.push("replatform"),e.traffic==="spiky"&&!t.includes("refactor")&&t.push("refactor");const r=new Set(["VPC + Subnets + NAT","ALB / NLB","CloudWatch + X-Ray + Logs","AWS Backup","Security Hub + GuardDuty","IAM Identity Center (SSO)"]);t.includes("rehost")&&r.add("EC2 + ASG"),t.includes("replatform")&&r.add("ECS on Fargate"),t.includes("refactor")&&r.add("Lambda + API Gateway + EventBridge");const o={none:"",mysql:"Amazon RDS for MySQL (Multi-AZ)",postgres:"Amazon RDS for PostgreSQL (Multi-AZ)",sqlserver:"Amazon RDS for SQL Server (Multi-AZ)",nosql:"Amazon DynamoDB",mixed:"RDS (engine-matched) + DynamoDB"};e.dbType!=="none"&&r.add(o[e.dbType]);let s=1;e.multiRegion&&(s+=1),e.regulated&&(s+=1);const l={rehost:.5,replatform:.75,refactor:1.25};let i=0;t.forEach(b=>{i+=l[b]*e.workloads});const u={high:1.3,medium:1.1,low:1}[e.criticality],c=e.traffic==="spiky"||e.traffic==="seasonal"?1.1:1,y=e.dbType!=="none"?.5:0,f=(s+i+y)*u*c,d=Math.max(3,Math.round(f*2)/2),p=[{title:"Discover & Assess",weeks:"Weeks 1–2",bullets:["Inventory apps & dependencies","Landing zone guardrails (CIS)","Choose 6R strategy per workload",e.regulated?"Compliance requirements mapping":"",e.multiRegion?"Multi-region architecture planning":""].filter(Boolean)},{title:"Landing Zone",weeks:`Weeks 2–${2+Math.ceil(s)}`,bullets:["VPC & routing setup","Observability + backups","Baseline security controls",e.multiRegion?"Cross-region connectivity":"",e.regulated?"Compliance controls implementation":""].filter(Boolean)},{title:"Pilot Migration",weeks:`Weeks ${2+Math.ceil(s)}–${4+Math.ceil(s)}`,bullets:[t.includes("rehost")?"Rehost pilot on EC2":"Containerize pilot on ECS Fargate","Cutover plan + rollback","Performance & cost validation","Security & compliance validation"]},{title:"Scale & Optimize",weeks:`Weeks ${4+Math.ceil(s)}–${d}`,bullets:["Wave-based migrations","Automate guardrails & tags","FinOps cadence (rightsizing, SPs)","Continuous optimization"]}],S=["Enable Security Hub","CloudTrail multi-region","AWS Backup configured","IAM Identity Center setup",e.regulated?"Compliance framework mapping":"",e.multiRegion?"Multi-region backup strategy":""].filter(Boolean);return{strategy:t,recommended:Array.from(r).filter(Boolean),effortWeeks:d,phases:p,prerequisites:S}}calculateBusinessImpact(e,t){const r=t.downtimeCostPerHour*t.hoursAvoidedPerMonth,o=Math.min(t.highSeverityExposures,Math.floor(t.highSeverityExposures*.7)),s=e.workloads*200,l=`${t.latencyImprovement}% faster response times`;return{avoidedDowntimeCost:r,riskReduction:o,costOptimization:s,performanceEfficiency:l}}calculateSavings(e){const t=e.ec2MonthlyCost*.25*(e.rightsizingAdoption/100),r=e.ec2MonthlyCost*.5*(e.idleSchedulingHours/24),o=e.includeStorageTransitions?e.s3MonthlyCost*.2:0;return{total:t+r+o,breakdown:{rightsizing:t,scheduling:r,storage:o}}}}const $=new E;export{M as a,D as b,T as c,L as d,_ as e,P as f,x as g,F as h,R as m,$ as p};
