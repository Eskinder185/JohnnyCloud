import{j as e}from"./index-e9d8c211.js";import{r as h}from"./react-vendor-cf6d7c8c.js";import{C as g}from"./Card-f7a2a7e8.js";import{B as v}from"./Button-d14573c5.js";import{a as Q}from"./dateUtils-ee9ad50a.js";import{R as Y,L as V,C as X,X as Z,Y as ee,T as se,a as te,b as ie}from"./chart-vendor-a9e21794.js";import"./ui-vendor-5be21587.js";const W="https://4z2t2pj4r4.execute-api.us-east-1.amazonaws.com/guardrails",re={framework:"CIS",score:74,totals:{pass:18,fail:6,warn:3},controls:[{id:"CIS-1.1",title:"S3 Block Public Access",status:"FAIL",pass:0,fail:3,warn:0,resources:[{arn:"arn:aws:s3:::demo-bucket",service:"s3",region:"us-east-1",note:"Public ACL",findingId:"arn:aws:securityhub:us-east-1:123456789012:finding/12345678-1234-1234-1234-123456789012"},{arn:"arn:aws:s3:::public-data-bucket",service:"s3",region:"us-west-2",note:"Public read policy",findingId:"arn:aws:securityhub:us-west-2:123456789012:finding/87654321-4321-4321-4321-210987654321"},{arn:"arn:aws:s3:::test-bucket",service:"s3",region:"eu-west-1",note:"Bucket policy allows public access"}]},{id:"CIS-1.2",title:"CloudTrail enabled",status:"PASS",pass:1,fail:0,warn:0,resources:[{arn:"arn:aws:cloudtrail:us-east-1:123456789012:trail/main-trail",service:"cloudtrail",region:"us-east-1"}]},{id:"CIS-2.1",title:"IAM Root User Access Keys",status:"WARN",pass:0,fail:0,warn:1,resources:[{arn:"arn:aws:iam::123456789012:root",service:"iam",region:"global",note:"Root access key exists but not recently used"}]},{id:"CIS-2.2",title:"MFA Enabled for Root User",status:"PASS",pass:1,fail:0,warn:0,resources:[]},{id:"CIS-3.1",title:"CloudTrail Log File Validation",status:"FAIL",pass:0,fail:1,warn:0,resources:[{arn:"arn:aws:cloudtrail:us-east-1:123456789012:trail/main-trail",service:"cloudtrail",region:"us-east-1",note:"Log file validation disabled"}]},{id:"CIS-3.2",title:"CloudTrail Multi-Region",status:"PASS",pass:1,fail:0,warn:0,resources:[]},{id:"CIS-4.1",title:"Security Groups - SSH Access",status:"FAIL",pass:0,fail:2,warn:1,resources:[{arn:"arn:aws:ec2:us-east-1:123456789012:security-group/sg-12345678",service:"ec2",region:"us-east-1",note:"SSH open to 0.0.0.0/0"},{arn:"arn:aws:ec2:us-west-2:123456789012:security-group/sg-87654321",service:"ec2",region:"us-west-2",note:"SSH open to 0.0.0.0/0"}]},{id:"CIS-4.2",title:"Security Groups - RDP Access",status:"PASS",pass:3,fail:0,warn:0,resources:[]}]},ae={framework:"NIST",score:68,totals:{pass:12,fail:8,warn:4},controls:[{id:"NIST-AC-1",title:"Access Control Policy and Procedures",status:"PASS",pass:1,fail:0,warn:0,resources:[]},{id:"NIST-AC-2",title:"Account Management",status:"FAIL",pass:0,fail:2,warn:1,resources:[{arn:"arn:aws:iam::123456789012:user/admin-user",service:"iam",region:"global",note:"No MFA enabled"}]}]},le={framework:"PCI",score:82,totals:{pass:15,fail:3,warn:2},controls:[{id:"PCI-1.1",title:"Firewall Configuration",status:"PASS",pass:1,fail:0,warn:0,resources:[]},{id:"PCI-2.1",title:"Default Password Policy",status:"FAIL",pass:0,fail:1,warn:0,resources:[{arn:"arn:aws:iam::123456789012:account",service:"iam",region:"global",note:"Weak password policy"}]}]};async function ne(c="CIS"){try{const l=await fetch(`${W}/summary?framework=${c}`,{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"});if(!l.ok){const a=await l.text();throw console.error("Guardrails API error:",l.status,l.statusText,a),new Error(`Guardrails API failed: ${l.status} ${l.statusText} - ${a}`)}const s=l.headers.get("content-type");if(s&&s.includes("text/html")){const a=await l.text();throw console.error("Guardrails API returned HTML instead of JSON:",a.substring(0,200)),new Error("API returned HTML error page instead of JSON")}return await l.json()}catch(l){switch(console.error("Guardrails API error:",l),c){case"NIST":return ae;case"PCI":return le;default:return re}}}async function ce(c,l,s=!0){try{const a=await fetch(`${W}/remediate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({controlId:c,resourceArn:l,dryRun:s})});if(!a.ok)throw new Error(`remediate ${a.status}`);return a.json()}catch(a){return console.error("Remediation API error:",a),{actionId:crypto.randomUUID(),status:"ERROR",message:`Failed to queue remediation: ${a instanceof Error?a.message:"Unknown error"}`}}}async function de(c){try{const l=await fetch(`${W}/evidence?control=${encodeURIComponent(c)}`);if(!l.ok)throw new Error(`evidence ${l.status}`);return l.json()}catch(l){return console.error("Evidence API error:",l),{controlId:c,generatedAt:new Date().toISOString(),items:[]}}}function B(c,l){const s=c.toLowerCase(),a=l.toLowerCase();return s.includes("1.1")||s.includes("1.2")||s.includes("2.1")||s.includes("2.2")||s.includes("3.1")||s.includes("3.2")||s.includes("4.1")||s.includes("4.2")||a.includes("public")||a.includes("root")||a.includes("mfa")||a.includes("encryption")?"High":s.includes("5.")||s.includes("6.")||s.includes("7.")||s.includes("8.")||a.includes("logging")||a.includes("monitoring")||a.includes("network")?"Medium":"Low"}function oe(c){return{High:{level:"High",color:"text-red-400",bgColor:"bg-red-500/20",borderColor:"border-red-500/30",icon:"ðŸ”´",description:"Critical security risk requiring immediate attention"},Medium:{level:"Medium",color:"text-amber-400",bgColor:"bg-amber-500/20",borderColor:"border-amber-500/30",icon:"ðŸŸ¡",description:"Moderate security risk that should be addressed soon"},Low:{level:"Low",color:"text-green-400",bgColor:"bg-green-500/20",borderColor:"border-green-500/30",icon:"ðŸŸ¢",description:"Low security risk with minimal immediate impact"},Informational:{level:"Informational",color:"text-blue-400",bgColor:"bg-blue-500/20",borderColor:"border-blue-500/30",icon:"â„¹ï¸",description:"Informational finding for awareness"}}[c]}function me(c,l,s=1){return{High:3,Medium:2,Low:1,Informational:.5}[c]*l*s}function ue(c,l,s){const a=l.toLowerCase();return s.some(d=>{var p,b;return((p=d.note)==null?void 0:p.toLowerCase().includes("public"))||((b=d.note)==null?void 0:b.toLowerCase().includes("0.0.0.0/0"))})||a.includes("public")?3:a.includes("security group")||a.includes("access")||a.includes("network")?2:1}function L({severity:c,className:l="",showIcon:s=!0,tooltip:a=!0}){const t=oe(c),d=e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${t.bgColor} ${t.borderColor} ${t.color} ${l}`,role:"img","aria-label":`${c} severity`,children:[s&&e.jsx("span",{"aria-hidden":"true",children:t.icon}),e.jsx("span",{children:t.level})]});return a?e.jsxs("div",{className:"group relative inline-block",children:[d,e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-black/90 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[t.description,e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-black/90"})]})]}):d}function xe({isOpen:c,onClose:l,onExecute:s,controls:a,title:t,description:d}){const[p,b]=h.useState(new Set),[w,k]=h.useState(!1),[x,C]=h.useState(!1);if(!c)return null;const y=a.reduce((n,r)=>n+r.resources.length,0),N=p.size,S=n=>{const r=new Set(p);r.has(n)?r.delete(n):r.add(n),b(r)},R=()=>{if(p.size===y)b(new Set);else{const n=a.flatMap(r=>r.resources.map(j=>j.arn));b(new Set(n))}},P=async()=>{if(N!==0){C(!0);try{await s(Array.from(p),w),l()}catch(n){console.error("Bulk remediation failed:",n),alert(`Failed to execute bulk remediation: ${n instanceof Error?n.message:"Unknown error"}`)}finally{C(!1)}}},F=()=>{const n=new Set(a.flatMap(j=>j.resources.map(M=>M.service))),r=[];return n.has("s3")&&r.push("s3:PutBucketPublicAccessBlock","s3:PutBucketPolicy","s3:PutBucketAcl"),n.has("ec2")&&r.push("ec2:AuthorizeSecurityGroupIngress","ec2:RevokeSecurityGroupIngress","ec2:ModifySecurityGroupRules"),n.has("cloudtrail")&&r.push("cloudtrail:UpdateTrail","cloudtrail:PutEventSelectors"),n.has("iam")&&r.push("iam:UpdateAccountPasswordPolicy","iam:CreateVirtualMFADevice","iam:EnableMFADevice"),r},T=()=>{const n=[],r=[];return a.forEach(j=>{(j.id.includes("1.1")||j.title.toLowerCase().includes("s3 public access"))&&(n.push("S3 buckets may become temporarily inaccessible during remediation"),r.push("Disable S3 Block Public Access via AWS Console or CLI")),(j.id.includes("4.1")||j.title.toLowerCase().includes("security group"))&&(n.push("Network access may be restricted, potentially blocking legitimate traffic"),r.push("Restore original security group rules from backup or AWS Config")),(j.id.includes("3.1")||j.title.toLowerCase().includes("cloudtrail"))&&(n.push("Logging configuration changes may affect compliance monitoring"),r.push("Revert CloudTrail settings to previous configuration"))}),{risks:[...new Set(n)],rollbacks:[...new Set(r)]}},{risks:$,rollbacks:E}=T();return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-black/90 border border-white/20 rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:t}),e.jsx("p",{className:"text-jc-dim text-sm",children:d})]}),e.jsx(v,{onClick:l,className:"px-3 py-1",children:"Close"})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[e.jsxs(g,{className:"p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Remediation Summary"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-jc-dim",children:"Controls"}),e.jsx("div",{className:"font-medium",children:a.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-jc-dim",children:"Total Resources"}),e.jsx("div",{className:"font-medium",children:y})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-jc-dim",children:"Selected"}),e.jsx("div",{className:"font-medium text-cyan-300",children:N})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Resources to Remediate"}),e.jsx(v,{onClick:R,className:"px-3 py-1 text-xs",variant:"outline",children:p.size===y?"Deselect All":"Select All"})]}),a.map(n=>e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(L,{severity:n.severity}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm",children:[n.id," â€” ",n.title]}),e.jsxs("div",{className:"text-xs text-jc-dim",children:[n.resources.length," resource",n.resources.length!==1?"s":""]})]})]}),e.jsx("div",{className:"space-y-2",children:n.resources.map((r,j)=>e.jsxs("label",{className:"flex items-center gap-3 p-2 bg-white/5 rounded border border-white/10 hover:bg-white/10 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.has(r.arn),onChange:()=>S(r.arn),className:"rounded border-white/20 bg-transparent text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-mono text-xs break-all",children:r.arn}),e.jsxs("div",{className:"text-xs text-jc-dim",children:[r.service.toUpperCase()," â€¢ ",r.region,r.note&&` â€¢ ${r.note}`]})]})]},j))})]},n.id))]}),e.jsxs(g,{className:"p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Required Permissions"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2",children:F().map((n,r)=>e.jsx("div",{className:"font-mono text-xs bg-white/5 p-2 rounded border border-white/10",children:n},r))})]}),e.jsxs(g,{className:"p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Risks & Rollback"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-red-400 mb-2",children:"Potential Risks"}),e.jsx("ul",{className:"text-xs text-jc-dim space-y-1",children:$.map((n,r)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"â€¢"}),n]},r))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-amber-400 mb-2",children:"Rollback Steps"}),e.jsx("ul",{className:"text-xs text-jc-dim space-y-1",children:E.map((n,r)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400 mt-0.5",children:"â€¢"}),n]},r))})]})]})]}),e.jsx(g,{className:"p-4 mb-6",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:n=>k(n.target.checked),className:"rounded border-white/20 bg-transparent text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Notify when remediation is complete"}),e.jsx("div",{className:"text-xs text-jc-dim",children:"Receive email/Slack notification when all selected resources have been remediated"})]})]})})]}),e.jsxs("div",{className:"p-6 border-t border-white/20 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-jc-dim",children:N>0?`${N} resource${N!==1?"s":""} selected`:"No resources selected"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(v,{onClick:l,variant:"outline",disabled:x,children:"Cancel"}),e.jsx(v,{onClick:P,disabled:N===0||x,className:"px-6",children:x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Executing..."]}):`Run Remediation (${N})`})]})]})]})})}function he({data:c,loading:l=!1}){if(l)return e.jsx("div",{className:"h-64 bg-white/5 rounded-lg animate-pulse flex items-center justify-center",children:e.jsx("span",{className:"text-white/50",children:"Loading compliance trend..."})});if(!c||c.length===0)return e.jsx("div",{className:"h-64 bg-white/5 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white/50",children:"No compliance data available"})});const s=({active:t,payload:d,label:p})=>{if(t&&d&&d.length){const b=d[0].payload;return e.jsxs("div",{className:"bg-black/80 border border-white/20 rounded-lg p-3 text-sm",children:[e.jsx("p",{className:"text-white/70 mb-1",children:p}),e.jsxs("p",{className:"text-white",children:["Score: ",e.jsxs("span",{className:"text-cyan-300",children:[b.score,"%"]})]}),e.jsxs("p",{className:"text-white",children:["Passed: ",e.jsx("span",{className:"text-green-400",children:b.passed})," / Failed: ",e.jsx("span",{className:"text-red-400",children:b.failed})]}),b.hasRemediation&&e.jsxs("p",{className:"text-white",children:["Remediation: ",e.jsx("span",{className:"text-amber-300",children:b.remediationType})]})]})}return null},a=t=>{const{payload:d}=t;return d.hasRemediation?e.jsx(ie,{...t,r:6,fill:"#f59e0b",stroke:"#f59e0b",strokeWidth:2}):null};return e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(V,{data:c,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(X,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(Z,{dataKey:"date",stroke:"rgba(255,255,255,0.6)",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:t=>{const d=new Date(t);return`${d.getMonth()+1}/${d.getDate()}`}}),e.jsx(ee,{stroke:"rgba(255,255,255,0.6)",fontSize:12,tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:t=>`${t}%`}),e.jsx(se,{content:e.jsx(s,{})}),e.jsx(te,{type:"monotone",dataKey:"score",stroke:"#06b6d4",strokeWidth:3,dot:t=>e.jsx(a,{...t}),activeDot:{r:6,stroke:"#06b6d4",strokeWidth:2}})]})})})}function pe({controls:c,onFixControl:l,loading:s=!1}){if(s)return e.jsx("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-5 shadow-[0_0_20px_rgba(0,0,0,0.25)] backdrop-blur",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-48 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-16 bg-white/10 rounded"},t))})]})});const a=c.filter(t=>t.status==="FAIL").map(t=>{let d="Medium";t.id.includes("1.1")||t.id.includes("1.2")||t.id.includes("2.1")||t.id.includes("2.2")||t.title.toLowerCase().includes("public")||t.title.toLowerCase().includes("root")||t.title.toLowerCase().includes("mfa")?d="High":t.id.includes("3.")||t.id.includes("4.")||t.title.toLowerCase().includes("logging")||t.title.toLowerCase().includes("monitoring")?d="Medium":d="Low";const p=ue(t.id,t.title,t.resources),b=me(d,t.fail,p);return{...t,severity:d,priority:b,exposureWeight:p}}).sort((t,d)=>d.priority-t.priority).slice(0,3);return a.length===0?e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-5 shadow-[0_0_20px_rgba(0,0,0,0.25)] backdrop-blur",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Compliance Checklist â€” Quick Wins"}),e.jsxs("div",{className:"text-center py-8 text-jc-dim",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸŽ‰"}),e.jsx("div",{className:"text-sm",children:"All critical controls are passing!"}),e.jsx("div",{className:"text-xs mt-1",children:"Great job maintaining compliance."})]})]}):e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-5 shadow-[0_0_20px_rgba(0,0,0,0.25)] backdrop-blur",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Compliance Checklist â€” Quick Wins"}),e.jsx("p",{className:"text-sm text-jc-dim mb-4",children:"Prioritized fixes to improve your compliance score quickly"}),e.jsx("div",{className:"space-y-3",children:a.map((t,d)=>e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-cyan-300",children:["#",d+1]}),e.jsx(L,{severity:t.severity})]}),e.jsx("button",{onClick:()=>l(t.id),className:"px-3 py-1 text-xs bg-cyan-500/20 text-cyan-300 hover:bg-cyan-500/30 rounded border border-cyan-500/30 transition-colors",children:"Fix now"})]}),e.jsxs("div",{className:"text-sm font-medium mb-1",children:[t.id," â€” ",t.title]}),e.jsxs("div",{className:"text-xs text-jc-dim mb-2",children:[t.fail," resource",t.fail!==1?"s":""," need",t.fail===1?"s":""," attention"]}),e.jsx("div",{className:"text-xs text-jc-dim",children:be(t.id,t.title,t.fail,t.exposureWeight)})]},t.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:e.jsxs("div",{className:"text-xs text-jc-dim",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Fixing these ",a.length," controls could improve your compliance score by up to"," ",Math.round(a.reduce((t,d)=>t+d.fail*2,0))," points."]})})]})}function be(c,l,s,a){const t=l.toLowerCase();return c.includes("1.1")||t.includes("s3 public access")?"Public S3 buckets pose high security risk. Blocking public access is a quick, safe fix that prevents data breaches.":c.includes("2.1")||c.includes("2.2")||t.includes("root")?"Root user security is critical. Enabling MFA and removing access keys significantly reduces account compromise risk.":c.includes("4.1")||t.includes("security group")?"Open security groups expose services to the internet. Restricting access to specific IPs improves network security.":c.includes("3.1")||t.includes("cloudtrail")?"CloudTrail logging is essential for compliance. Enabling log validation ensures audit trail integrity.":t.includes("mfa")?"Multi-factor authentication prevents unauthorized access. This is a low-effort, high-impact security improvement.":t.includes("encryption")?"Encryption protects data at rest and in transit. Enabling encryption is a compliance requirement with minimal performance impact.":`This control affects ${s} resource${s!==1?"s":""} and has ${a===3?"high":a===2?"medium":"low"} exposure risk.`}function Ce(){const[c,l]=h.useState("CIS"),[s,a]=h.useState(null),[t,d]=h.useState(!1),[p,b]=h.useState(null),[w,k]=h.useState(null),[x,C]=h.useState(null),[y,N]=h.useState("30d"),[S,R]=h.useState(!1),[P,F]=h.useState([]),[T,$]=h.useState(""),[E,n]=h.useState("");h.useEffect(()=>{let i=!0;return d(!0),b(null),k(null),ne(c).then(m=>{if(i&&(a(m),m&&m.controls&&Array.isArray(m.controls))){const u=m.controls.find(o=>o.status==="FAIL");u&&k(u.id)}}).catch(m=>{console.error("Error loading guardrails data:",m),b(String(m))}).finally(()=>d(!1)),()=>{i=!1}},[c]);const r=h.useMemo(()=>s!=null&&s.controls&&Array.isArray(s.controls)&&s.controls.find(i=>i.id===w)||null,[w,s]),j=i=>i>=80?"text-emerald-600":i>=60?"text-amber-600":"text-red-600",M=i=>i>=80?"bg-emerald-50 border-emerald-200":i>=60?"bg-amber-50 border-amber-200":"bg-red-50 border-red-200",G=i=>{switch(i){case"PASS":return"text-emerald-600 bg-emerald-50 border-emerald-200";case"FAIL":return"text-red-600 bg-red-50 border-red-200";case"WARN":return"text-amber-600 bg-amber-50 border-amber-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},_=h.useMemo(()=>{const i=y==="30d"?30:90,m=[],u=new Date;for(let o=i-1;o>=0;o--){const f=new Date(u);f.setDate(f.getDate()-o);const I=74,K=Math.sin(o/7)*5+Math.random()*3,U=Math.max(0,Math.min(100,Math.round(I+K))),D=27,O=Math.round(U/100*D),J=D-O;m.push({date:f.toISOString().split("T")[0],score:U,passed:O,failed:J,total:D,hasRemediation:Math.random()>.9,remediationType:Math.random()>.5?"Bulk SG fix":"S3 access fix"})}return m},[y]);async function z(i){if(!r)return;C(i||"all");try{const u=await ce(r.id,i,!0),o=i?`Remediation queued for resource:
${i}

Action ID: ${u.actionId}
Status: ${u.status}`:`Remediation queued for control ${r.id}

Action ID: ${u.actionId}
Status: ${u.status}`;alert(o)}catch(u){console.error("Remediation error:",u),alert(`Failed to queue remediation: ${u instanceof Error?u.message:"Unknown error"}`)}finally{C(null)}}const A=i=>{if(!s)return;let m=[],u="",o="";if(!(!s||!s.controls||!Array.isArray(s.controls))){switch(i){case"s3-public":m=s.controls.filter(f=>f.id.includes("1.1")||f.title.toLowerCase().includes("s3 public access")),u="Fix All S3 Public Access Issues",o="Remediate all S3 buckets with public access enabled";break;case"security-groups":m=s.controls.filter(f=>f.id.includes("4.1")||f.title.toLowerCase().includes("security group")),u="Fix All Security Group Issues",o="Restrict open security group rules to improve network security";break;case"cloudtrail":m=s.controls.filter(f=>f.id.includes("3.1")||f.title.toLowerCase().includes("cloudtrail")),u="Fix All CloudTrail Issues",o="Enable CloudTrail log validation and multi-region trails";break;case"selected":r&&(m=[r],u=`Fix All ${r.id} Issues`,o=`Remediate all resources for control ${r.id}`);break}if(m.length>0){const f=m.map(I=>({...I,severity:B(I.id,I.title)}));F(f),$(u),n(o),R(!0)}}},q=async(i,m)=>{console.log("Executing bulk remediation:",{controls:P.map(u=>u.id),resources:i,notifyWhenDone:m}),await new Promise(u=>setTimeout(u,2e3)),alert(`Bulk remediation completed for ${i.length} resources${m?". You will be notified when done.":"."}`)},H=i=>{s!=null&&s.controls&&Array.isArray(s.controls)&&s.controls.find(u=>u.id===i)&&(k(i),A("selected"))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{className:"p-6",children:[e.jsxs("header",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-semibold mb-2 jc-title-gradient",children:"Compliance & Guardrails"}),e.jsx("p",{className:"text-sm md:text-base text-white/75 leading-relaxed",children:"Monitor compliance across security frameworks and manage remediation actions"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-jc-dim",children:"Framework:"}),e.jsxs("select",{className:"bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-jc-cyan",value:c,onChange:i=>l(i.target.value),disabled:t,children:[e.jsx("option",{value:"CIS",children:"CIS"}),e.jsx("option",{value:"NIST",children:"NIST"}),e.jsx("option",{value:"PCI",children:"PCI"})]})]})})]}),t&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-jc-cyan"}),e.jsx("span",{className:"ml-3 text-jc-dim",children:"Loading guardrails data..."})]}),p&&e.jsxs("div",{className:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm",children:["Error loading guardrails data: ",p]})]}),s&&e.jsxs("div",{"data-guardrails-summary":JSON.stringify(s),children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"text-sm text-jc-dim mb-1",children:"Framework"}),e.jsx("div",{className:"text-xl font-semibold",children:s.framework})]}),e.jsxs(g,{className:`p-6 border-2 ${M(s.score)}`,children:[e.jsx("div",{className:"text-sm text-jc-dim mb-1",children:"Compliance Score"}),e.jsxs("div",{className:`text-3xl font-bold ${j(s.score)}`,children:[s.score,"%"]})]}),e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"text-sm text-jc-dim mb-1",children:"Controls Passed"}),e.jsx("div",{className:"text-2xl font-semibold text-emerald-600",children:s.totals.pass})]}),e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"text-sm text-jc-dim mb-1",children:"Failed / Warnings"}),e.jsxs("div",{className:"text-xl",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:s.totals.fail}),e.jsx("span",{className:"text-jc-dim mx-1",children:"/"}),e.jsx("span",{className:"text-amber-600 font-semibold",children:s.totals.warn})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Compliance Trend (",s.framework,")"]}),e.jsx("div",{className:"flex gap-1",children:["30d","90d"].map(i=>e.jsx("button",{onClick:()=>N(i),className:`px-3 py-1 text-xs rounded transition-colors ${y===i?"bg-cyan-500/20 text-cyan-300 border border-cyan-500/30":"bg-white/5 text-slate-400 hover:bg-white/10 border border-white/10"}`,children:i},i))})]}),e.jsx(he,{data:_,loading:t,timeRange:y})]})}),e.jsx("div",{children:e.jsx(pe,{controls:s.controls,onFixControl:H,loading:t})})]}),e.jsxs(g,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Bulk Remediation Actions"}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs(v,{onClick:()=>A("s3-public"),className:"p-4 h-auto flex flex-col items-center gap-2",disabled:!(s!=null&&s.controls)||!Array.isArray(s.controls)||!s.controls.some(i=>i.id.includes("1.1")||i.title.toLowerCase().includes("s3 public access")),children:[e.jsx("div",{className:"text-2xl",children:"ðŸª£"}),e.jsx("div",{className:"text-sm",children:"Fix S3 Public Access"}),e.jsx("div",{className:"text-xs opacity-70",children:"Block public access on all buckets"})]}),e.jsxs(v,{onClick:()=>A("security-groups"),className:"p-4 h-auto flex flex-col items-center gap-2",disabled:!(s!=null&&s.controls)||!Array.isArray(s.controls)||!s.controls.some(i=>i.id.includes("4.1")||i.title.toLowerCase().includes("security group")),children:[e.jsx("div",{className:"text-2xl",children:"ðŸ”’"}),e.jsx("div",{className:"text-sm",children:"Fix Security Groups"}),e.jsx("div",{className:"text-xs opacity-70",children:"Restrict open ingress rules"})]}),e.jsxs(v,{onClick:()=>A("cloudtrail"),className:"p-4 h-auto flex flex-col items-center gap-2",disabled:!(s!=null&&s.controls)||!Array.isArray(s.controls)||!s.controls.some(i=>i.id.includes("3.1")||i.title.toLowerCase().includes("cloudtrail")),children:[e.jsx("div",{className:"text-2xl",children:"ðŸ“Š"}),e.jsx("div",{className:"text-sm",children:"Fix CloudTrail"}),e.jsx("div",{className:"text-xs opacity-70",children:"Enable log validation"})]}),e.jsxs(v,{onClick:()=>A("selected"),className:"p-4 h-auto flex flex-col items-center gap-2",disabled:!r,children:[e.jsx("div",{className:"text-2xl",children:"ðŸŽ¯"}),e.jsx("div",{className:"text-sm",children:"Fix Selected Control"}),e.jsx("div",{className:"text-xs opacity-70",children:"Remediate all resources"})]})]})]}),e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:["FAIL","WARN","PASS"].map(i=>{const m=s!=null&&s.controls&&Array.isArray(s.controls)?s.controls.filter(o=>o.status===i):[],u={FAIL:{label:"Failed Controls",color:"border-red-500/30 bg-red-500/10"},WARN:{label:"Warnings",color:"border-amber-500/30 bg-amber-500/10"},PASS:{label:"Passed Controls",color:"border-emerald-500/30 bg-emerald-500/10"}}[i];return e.jsxs(g,{className:`p-6 border-2 ${u.color}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:u.label}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${G(i)}`,children:m.length})]}),e.jsxs("div",{className:"space-y-3",children:[m.map(o=>{const f=B(o.id,o.title);return e.jsxs("button",{className:`w-full text-left p-4 rounded-lg border transition-all ${w===o.id?"border-jc-cyan bg-jc-cyan/10":"border-white/20 bg-white/5 hover:bg-white/10"}`,onClick:()=>k(o.id),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"font-medium text-sm",children:[o.id," â€” ",o.title]}),o.status==="FAIL"&&e.jsx(L,{severity:f,showIcon:!1})]}),e.jsxs("div",{className:"text-xs text-jc-dim",children:["Pass ",o.pass," Â· Fail ",o.fail," Â· Warn ",o.warn]}),o.resources.length>0&&e.jsxs("div",{className:"text-xs text-jc-dim mt-1",children:[o.resources.length," resource",o.resources.length!==1?"s":""]})]},o.id)}),m.length===0&&e.jsxs("div",{className:"text-sm text-jc-dim text-center py-4",children:["No ",i.toLowerCase()," controls"]})]})]},i)})}),e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Control Details"}),r&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{severity:B(r.id,r.title)}),e.jsxs("div",{className:"text-sm text-jc-dim",children:[r.id," â€” ",r.title]})]})]}),!r&&e.jsx("div",{className:"text-center py-8 text-jc-dim",children:"Select a control above to view resource details"}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-jc-dim",children:"Status"}),e.jsx("div",{className:`inline-block px-2 py-1 rounded text-xs font-medium ${G(r.status)}`,children:r.status})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-jc-dim",children:"Resources"}),e.jsx("div",{className:"font-medium",children:r.resources.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-jc-dim",children:"Failed"}),e.jsx("div",{className:"font-medium text-red-400",children:r.fail})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-jc-dim",children:"Passed"}),e.jsx("div",{className:"font-medium text-emerald-400",children:r.pass})]})]}),r.resources.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b border-white/20",children:[e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Resource ARN"}),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Service"}),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Region"}),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Finding ID"}),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Note"}),e.jsx("th",{className:"py-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:r.resources.map((i,m)=>e.jsxs("tr",{className:"border-b border-white/10 last:border-none",children:[e.jsx("td",{className:"py-3 pr-4 font-mono text-xs break-all",children:i.arn}),e.jsx("td",{className:"py-3 pr-4",children:e.jsx("span",{className:"inline-block px-2 py-1 bg-jc-cyan/20 text-jc-cyan rounded text-xs font-medium",children:i.service.toUpperCase()})}),e.jsx("td",{className:"py-3 pr-4 text-jc-dim",children:i.region}),e.jsx("td",{className:"py-3 pr-4",children:i.findingId?e.jsx("span",{className:"text-xs font-mono text-jc-dim break-all",children:i.findingId}):e.jsx("span",{className:"text-jc-dim",children:"â€”"})}),e.jsx("td",{className:"py-3 pr-4 text-jc-dim",children:i.note||"â€”"}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{onClick:()=>z(i.arn),disabled:x===i.arn,className:"px-3 py-1 text-xs",children:x===i.arn?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-white"}),"Remediating..."]}):"Remediate"}),e.jsx(fe,{controlId:r.id})]})})]},m))})]})}):e.jsx("div",{className:"text-center py-8 text-jc-dim",children:"No resources associated with this control"}),r.resources.length>0&&e.jsx("div",{className:"flex gap-3 pt-4 border-t border-white/20",children:e.jsx(v,{onClick:()=>z(),disabled:x==="all",className:"px-4 py-2",children:x==="all"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Remediating All..."]}):"Remediate All Resources"})})]})]})]}),e.jsx(xe,{isOpen:S,onClose:()=>R(!1),onExecute:q,controls:P,title:T,description:E})]})}function fe({controlId:c}){const[l,s]=h.useState(!1),[a,t]=h.useState(!1),[d,p]=h.useState([]),[b,w]=h.useState(null);async function k(){t(!0),w(null);try{const x=await de(c);p(x.items||[])}catch(x){w(x instanceof Error?x.message:"Failed to load evidence"),p([])}finally{t(!1)}}return e.jsxs(e.Fragment,{children:[e.jsx(v,{onClick:()=>{s(!0),k()},className:"px-3 py-1 text-xs",children:"Evidence"}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:()=>s(!1),children:e.jsxs("div",{className:"bg-black/90 border border-white/20 rounded-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-hidden",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Evidence for ",c]}),e.jsx(v,{onClick:()=>s(!1),className:"px-3 py-1",children:"Close"})]}),e.jsx("div",{className:"overflow-y-auto max-h-[60vh]",children:a?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-jc-cyan"}),e.jsx("span",{className:"ml-3 text-jc-dim",children:"Loading evidence..."})]}):b?e.jsxs("div",{className:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm",children:["Error: ",b]}):d.length>0?e.jsx("div",{className:"space-y-4",children:d.map((x,C)=>{var y;return e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-sm capitalize",children:((y=x.type)==null?void 0:y.replace("_"," "))||"Evidence Item"}),e.jsx("span",{className:"text-xs text-jc-dim",children:x.timestamp?Q(x.timestamp):"Unknown date"})]}),e.jsx("div",{className:"text-sm text-jc-dim mb-2",children:x.details}),x.findings&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs font-medium text-jc-dim",children:"Findings:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-xs text-jc-dim ml-2",children:x.findings.map((N,S)=>e.jsx("li",{children:N},S))})]}),x.recommendations&&e.jsxs("div",{className:"space-y-1 mt-2",children:[e.jsx("div",{className:"text-xs font-medium text-jc-dim",children:"Recommendations:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-xs text-jc-dim ml-2",children:x.recommendations.map((N,S)=>e.jsx("li",{children:N},S))})]})]},C)})}):e.jsx("div",{className:"text-center py-8 text-jc-dim",children:"No evidence available for this control"})})]})})]})}export{Ce as default};
