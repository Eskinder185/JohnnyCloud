import{j as t}from"./index-d7f71f52.js";import{r as a}from"./react-vendor-cf778ffd.js";import{M as P,P as D,S as J,V as L}from"./ui-vendor-9eb7d90f.js";function O({askEndpoint:j,context:R={},onSent:c}){const[r,n]=a.useState("idle"),[l,N]=a.useState(""),d=a.useRef(null),A=a.useRef(null),p=a.useRef(null),u=e=>{try{window.speechSynthesis.cancel()}catch{}if(!("speechSynthesis"in window))return;const s=new SpeechSynthesisUtterance(e);s.rate=1,s.pitch=1,s.volume=1,s.onend=()=>n("idle"),A.current=s,window.speechSynthesis.speak(s),n("speaking")},T=()=>{speechSynthesis.speaking&&!speechSynthesis.paused&&(speechSynthesis.pause(),n("paused"))},C=()=>{speechSynthesis.paused&&(speechSynthesis.resume(),n("speaking"))},h=()=>{var e,s;try{speechSynthesis.cancel()}catch{}try{(s=(e=d.current)==null?void 0:e.stop)==null||s.call(e)}catch{}clearTimeout(p.current),n("idle")},y=()=>{h();const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){alert("Voice input not supported in this browser.");return}const s=new e;s.lang="en-US",s.interimResults=!1,s.maxAlternatives=1,s.onresult=async v=>{var f,g,S;const x=(((S=(g=(f=v.results)==null?void 0:f[0])==null?void 0:g[0])==null?void 0:S.transcript)||"").trim();if(!x){n("idle");return}try{const k=await(await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:x,...R})})).json().catch(()=>({})),w=k.answer||k.message||"Sorry, I couldn't find an answer.";N(w),c==null||c(x,w),u(w)}catch{u("Sorry, there was a problem getting the answer.")}},s.onerror=()=>n("idle"),s.onend=()=>{},d.current=s,s.start(),n("listening")},m=()=>{clearTimeout(p.current),p.current=setTimeout(()=>{var e,s;try{(s=(e=d.current)==null?void 0:e.stop)==null||s.call(e)}catch{}},120)};a.useEffect(()=>()=>h(),[]);const o=r==="listening",b=r==="speaking",i=r==="paused";return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onMouseDown:y,onMouseUp:m,onTouchStart:e=>{e.preventDefault(),y()},onTouchEnd:e=>{e.preventDefault(),m()},onKeyDown:e=>{(e.code==="Space"||e.key==="Enter")&&y()},onKeyUp:e=>{(e.code==="Space"||e.key==="Enter")&&m()},"aria-pressed":o,"aria-label":"Hold to ask JohnnyCloud",className:`flex items-center gap-2 rounded-xl px-3 py-2 transition
          ${o?"bg-sky-300 text-slate-900":"bg-sky-400/90 text-slate-900 hover:bg-sky-300"}`,title:"Hold to speak. Release to send.",children:[t.jsx(P,{className:"h-4 w-4"}),t.jsx("span",{className:"font-semibold",children:o?"Listening…":"Ask JohnnyCloud"})]}),t.jsx("button",{onClick:i?C:T,disabled:!b&&!i,className:"rounded-lg border border-slate-600/60 px-2 py-2 text-slate-200 disabled:opacity-40","aria-label":i?"Resume speech":"Pause speech",children:t.jsx(D,{className:"h-4 w-4"})}),t.jsx("button",{onClick:h,disabled:r==="idle",className:"rounded-lg border border-slate-600/60 px-2 py-2 text-slate-200 disabled:opacity-40","aria-label":"Stop",children:t.jsx(J,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>l&&u(l),disabled:!l,className:"rounded-lg border border-slate-600/60 px-2 py-2 text-slate-200 disabled:opacity-40","aria-label":"Replay answer",children:t.jsx(L,{className:"h-4 w-4"})}),t.jsx("span",{className:"text-xs text-slate-400 ml-1",children:o?"release to send":b?"speaking…":i?"paused":""})]})}export{O as A};
